#!/bin/sh

echo "ðŸš€ Running pre-commit checks..."

FRONTEND_DIR="frontend"

cd "$FRONTEND_DIR" || {
    echo "âŒ Cannot enter $FRONTEND_DIR directory"
    exit 1
}

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "^$FRONTEND_DIR/.*\.\(ts\|tsx\|js\|jsx\)$" | sed "s|^$FRONTEND_DIR/||")

if [ "$STAGED_FILES" = "" ]; then
    echo "âœ… No frontend files to check"
    cd - > /dev/null
    exit 0
fi

echo "ðŸ“ Files to check:"
echo "$STAGED_FILES"

echo "ðŸ”§ Running ESLint..."
npx eslint --fix $STAGED_FILES
if [ $? -ne 0 ]; then
    echo "âŒ ESLint failed!"
    cd - > /dev/null
    exit 1
fi

echo "ðŸŽ¨ Running Prettier..."
npx prettier --write $STAGED_FILES
if [ $? -ne 0 ]; then
    echo "âŒ Prettier failed!"
    cd - > /dev/null
    exit 1
fi

cd - > /dev/null
git add $(echo "$STAGED_FILES" | sed "s|^|$FRONTEND_DIR/|")

echo "âœ… All checks passed! Committing..."
exit 0
